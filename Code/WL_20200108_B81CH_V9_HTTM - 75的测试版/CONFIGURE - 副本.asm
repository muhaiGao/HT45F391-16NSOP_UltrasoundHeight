INCLUDE		HT45F391.INC
IF 0 
;				28摄氏度		
;400US/10us		速度cm/s	GAIN_0	距离mm
;40				34844		1		69.688
;80				34844		2		139.376
;120			34844		3		209.064
;160			34844		4		278.752
;200			34844		5		348.44
;240			34844		6		418.128
;280			34844		7		487.816
;320			34844		8		557.504
;360			34844		9		627.192
;400			34844		10		696.88
;440			34844		11		766.568
;480			34844		12		836.256
;520			34844		13		905.944
;560			34844		14		975.632
;600			34844		15		1045.32
;640			34844		16		1115.008
;680			34844		17		1184.696
;720			34844		18		1254.384
;760			34844		19		1324.072
;800			34844		20		1393.76
;840			34844		21		1463.448
;880			34844		22		1533.136
;920			34844		23		1602.824
;960			34844		24		1672.512
;1000			34844		25		1742.2
;1040			34844		26		1811.888
;1080			34844		27		1881.576
;1120			34844		28		1951.264
;1160			34844		29		2020.952
;1200			34844		30		2090.64
;1240			34844		31		2160.328
ENDIF 
;#define		P_BUZZ				PA.2
;;CHECKSUM A932H
;;CHECKCODE 609BH
;400us为一级，1ms=17cm,400us=17/2.5=6.8cm	; GAIN * 0.5DB = X DB
;#define		GAIN_0				    2	
;#define		GAIN_1					4	
;#define		GAIN_2					6 	
;#define		GAIN_3					8 
;#define		GAIN_4					10 	
;#define		GAIN_5					12	
;#define	 	GAIN_6					14 	
;#define		GAIN_7					16
;#define		GAIN_8					32
;#define		GAIN_9					34	
;#define		GAIN_10					36
;#define		GAIN_11					38
;#define		GAIN_12					40	
;#define	    GAIN_13                 42
;#define	    GAIN_14                 44
;#define	    GAIN_15                 46
;#define	    GAIN_16                 34
;#define	    GAIN_17                 36
;#define	    GAIN_18                 38
;#define	    GAIN_19                 40
;#define	    GAIN_20                 42
;#define	    GAIN_21                 44
;#define	    GAIN_22                 46
;#define	    GAIN_23                 48
;#define	    GAIN_24                 50
;#define	    GAIN_25                 52
;#define	    GAIN_26                 54
;#define	    GAIN_27                 56
;#define	    GAIN_28                 58
;#define	    GAIN_29                 60  
;#define	    GAIN_30                 62
;#define	    GAIN_31                 62
;;;32cm-52cm会重叠5-9
;;;32cm-52cm会重叠5-9
#define		GAIN_0				    0;;1;
#define		GAIN_1					0;;1;
#define		GAIN_2					0;;2; 	
#define		GAIN_3					0;2;
#define		GAIN_4					1;;2;;3;	
#define		GAIN_5					1;;2;;6;
#define	 	GAIN_6					10;;22;	
#define		GAIN_7					10;;23;
#define		GAIN_8					12;;25;
#define		GAIN_9					13;;26;	
#define		GAIN_10					15;;28;   ;;80cm-160cm,11-23变小
#define		GAIN_11					20 ;;30;
#define		GAIN_12					21 ;;34;
#define	    GAIN_13                 23 ;;34;
#define	    GAIN_14                 32 ;35;
#define	    GAIN_15                 30 ;;35;
#define	    GAIN_16                35;
#define	    GAIN_17                35;34;
#define	    GAIN_18                36;35; 
#define	    GAIN_19                37;35;
#define	    GAIN_20                38;35; 
#define	    GAIN_21                42;;38;
#define	    GAIN_22                45;;38;  
#define	    GAIN_23                50;;38;  
#define	    GAIN_24                 54 ; 
#define	    GAIN_25                 54 ;
#define	    GAIN_26                 54 ;
#define	    GAIN_27                 54 ; 
#define	    GAIN_28                 54 ;
#define	    GAIN_29                 56 ;
#define	    GAIN_30                 56 ;
#define	    GAIN_31                 56 ;

;;;;阀值设置
#define		ADJ_THRESHOLD_VALUE_0		45 ;;30
#define		ADJ_THRESHOLD_VALUE_1		45 ;;30 
#define		ADJ_THRESHOLD_VALUE_2		45 ;;30		 
#define		ADJ_THRESHOLD_VALUE_3		45 ;;30
#define		ADJ_THRESHOLD_VALUE_4		45 ;;30
#define		ADJ_THRESHOLD_VALUE_5		45 ;;30 
#define		ADJ_THRESHOLD_VALUE_6		45 ;;30
#define		ADJ_THRESHOLD_VALUE_7		45 ;;30
#define		ADJ_THRESHOLD_VALUE_8		45 ;;30
#define		ADJ_THRESHOLD_VALUE_9		45 ;;30
#define		ADJ_THRESHOLD_VALUE_10		45 ;;30
#define		ADJ_THRESHOLD_VALUE_11		45 ;;30
#define		ADJ_THRESHOLD_VALUE_12		45 ;;30	
#define	    ADJ_THRESHOLD_VALUE_13      45 ;;30
#define	    ADJ_THRESHOLD_VALUE_14      45 ;;30
#define	    ADJ_THRESHOLD_VALUE_15      45 ;;30
#define	    ADJ_THRESHOLD_VALUE_16      40 ;;30
#define	    ADJ_THRESHOLD_VALUE_17      40 ;;30 ;29  
#define	    ADJ_THRESHOLD_VALUE_18      40 ;;30 ;29
#define	    ADJ_THRESHOLD_VALUE_19      40 ;;30
#define	    ADJ_THRESHOLD_VALUE_20      40 ;;30
#define	    ADJ_THRESHOLD_VALUE_21      40 ;;30
#define	    ADJ_THRESHOLD_VALUE_22      40 ;;30
#define	    ADJ_THRESHOLD_VALUE_23      40 ;;30
#define	    ADJ_THRESHOLD_VALUE_24      30
#define	    ADJ_THRESHOLD_VALUE_25      30
#define	    ADJ_THRESHOLD_VALUE_26      30
#define	    ADJ_THRESHOLD_VALUE_27      30
#define	    ADJ_THRESHOLD_VALUE_28      24
#define	    ADJ_THRESHOLD_VALUE_29      24
#define	    ADJ_THRESHOLD_VALUE_30      24
#define	    ADJ_THRESHOLD_VALUE_31	    24
	
#define		C_ECHO_REFERENCE_ADJ		5 ;5
#define		C_ECHO_REFERENCE_ADJ_MAX	20 ;65;60
#define		C_AFTERSHOCK_TIME_ADJ		1 ;5
#define		C_DISTANCE_ADJ				50 ;

;限定余震的最大和最小值
#define		C_MAX_AFTERSHOCK_TIME		25
#define		C_MIN_AFTERSHOCK_TIME		12

CONFIG		.SECTION	AT LASTPAGE	'CODE'
CFG_GAIN:
DW	GAIN_0
DW	GAIN_1
DW	GAIN_2
DW	GAIN_3
DW	GAIN_4
DW	GAIN_5
DW	GAIN_6
DW	GAIN_7
DW	GAIN_8
DW	GAIN_9
DW	GAIN_10
DW	GAIN_11
DW	GAIN_12
DW	GAIN_13
DW	GAIN_14
DW	GAIN_15
DW	GAIN_16
DW	GAIN_17
DW	GAIN_18
DW	GAIN_19
DW	GAIN_20
DW	GAIN_21
DW	GAIN_22
DW	GAIN_23
DW	GAIN_24
DW	GAIN_25
DW	GAIN_26
DW	GAIN_27
DW	GAIN_28
DW	GAIN_29
DW	GAIN_30
DW	GAIN_31
CFG_THRESHOLD_VALUE:
DW	ADJ_THRESHOLD_VALUE_0
DW	ADJ_THRESHOLD_VALUE_1
DW	ADJ_THRESHOLD_VALUE_2
DW	ADJ_THRESHOLD_VALUE_3
DW	ADJ_THRESHOLD_VALUE_4
DW	ADJ_THRESHOLD_VALUE_5
DW	ADJ_THRESHOLD_VALUE_6
DW	ADJ_THRESHOLD_VALUE_7
DW	ADJ_THRESHOLD_VALUE_8
DW	ADJ_THRESHOLD_VALUE_9
DW	ADJ_THRESHOLD_VALUE_10
DW	ADJ_THRESHOLD_VALUE_11
DW	ADJ_THRESHOLD_VALUE_12
DW	ADJ_THRESHOLD_VALUE_13
DW	ADJ_THRESHOLD_VALUE_14
DW	ADJ_THRESHOLD_VALUE_15
DW	ADJ_THRESHOLD_VALUE_16
DW	ADJ_THRESHOLD_VALUE_17
DW	ADJ_THRESHOLD_VALUE_18
DW	ADJ_THRESHOLD_VALUE_19
DW	ADJ_THRESHOLD_VALUE_20
DW	ADJ_THRESHOLD_VALUE_21
DW	ADJ_THRESHOLD_VALUE_22
DW	ADJ_THRESHOLD_VALUE_23
DW	ADJ_THRESHOLD_VALUE_24
DW	ADJ_THRESHOLD_VALUE_25
DW	ADJ_THRESHOLD_VALUE_26
DW	ADJ_THRESHOLD_VALUE_27
DW	ADJ_THRESHOLD_VALUE_28
DW	ADJ_THRESHOLD_VALUE_29
DW	ADJ_THRESHOLD_VALUE_30
DW	ADJ_THRESHOLD_VALUE_31

CFG_MAX_AFTERSHOCK_TIME:
DW	C_MAX_AFTERSHOCK_TIME

CFG_MIN_AFTERSHOCK_TIME:
DW	C_MIN_AFTERSHOCK_TIME

CFG_DISTANCE_ADJ:
DW	C_DISTANCE_ADJ

CFG_AFTERSHOCK_TIME_ADJ:
DW	C_AFTERSHOCK_TIME_ADJ

CFG_ECHO_REFERENCE_ADJ_MAX:
DW	C_ECHO_REFERENCE_ADJ_MAX

CFG_ECHO_REFERENCE_ADJ:
DW	C_ECHO_REFERENCE_ADJ

CFG_SYS:
;    BIT7   BIT6     BIT5     BIT4     BIT3     BIT2     BIT1     BIT0
;   SYSCLK   --       --       --       --       --       --     SENSORFRQ   
;SYSCLK
;0:timer0 使用内部fsys/16时钟源
;1:timer0 使用外部100k时钟源
;
;SENSORFRQ
;0:40K, 1:58K
DW	10000000B

R_T_TAB:
IF 0
;温度
;	-20		-19
DW	63582,	60647
;	-18		-17		-16		-15		-14		-13
DW	57873,	55249,	52766,	50416,	48191,	46082
;DW	63957,	60700,	57631,	54740
;;	-12		-11		-10		-9		-8		-7
DW	44083,	42187,	40388,	38679,	37055,	35512
;DW	52014,	49444,	47018,	44729,	42567,	40521
;;	-6		-5		-4		-3		-2		-1
DW	34044,	32647,	31316,	30048,	28840,	27687
;DW	38594,	36769,	35043,	33410,	31864,	30400
;;	0		1		2		3		4		5
DW	26587,	25559,	24553,	23574,	22627,	21712		
;DW	29014,	27700,	26455,	25274,	24153,	23090
;;	6		7		8		9		10		11
DW	20833,	19991,	19185,	18416,	17682,	16984
;DW	22081,	21123,	20212,	19347,	18525,	17743
;;	12		13		14		15		16		17
DW	16319,	15686,	15083,	14510,	13964,	13443
;DW	16999,	16291,	15618,	15552,	14365,	13783
;;	18	 	19		20		21		22		23
DW	12947,	12472,	12018,	11582,	11164,	10762
;DW	13228,	12700,	12195,	11714,	11255,	10817
;;	24		25		26		27		28		29
DW	10374,	10000,	9577,	9234,	8853,	8512
;DW	10399,	10000,	9618,	9253,	8905,	8572
;;	30		31		32		33		34		35
DW	8185,	7865,	7583,	7313,	7063,	6869
;DW	8253,	7948,	7656,	7377,	7110 ,	6854
;;	36		37		38		39		40		41
DW	6641,	6404,	6177,	5958,	5749,	5548	
;DW	6609,	6374,	6149,	5933,	5726,	5528
;;	42		43		44		45		46		47
DW	5355,	5170,	4992,	4822,	4658,	4500
;DW	5337,	5154,	4979,	4811,	4649,	4494
;;	48		49		50		51		52		53
DW	4349,	4204,	4065,	3931,	3802,	3678
;DW	4345,	4201,	4064,	3931,	3804,	3681
;;	54		55		56		57		58		59
DW	3559,	3445,	3335,	3229,	3127,	3029
;DW	3564,	3450,	3341,	3236,	3135,	3038

ELSE
;温度
;	-20		-19
DW	63591,	63591
;	-18		-17		-16		-15		-14		-13
DW	63591,	63591,	63591,	63591,	63582,	60394
;;	-12		-11		-10		-9		-8		-7
DW	57369,	54504,	51793,	49225,	46793,	44490
;;	-6		-5		-4		-3		-2		-1
DW	42309,	40243,	38285,	36430,	34672,	33005
;;	0		1		2		3		4		5
DW	31426,	29928,	28507,	27160,	25882,	24670		
;;	6		7		8		9		10		11
DW	23519,	22427,	21391,	20407,	19452,	18584
;;	12		13		14		15		16		17
DW	17741,	16940,	16178,	15455,	14766,	14112
;;	18	 	19		20		21		22		23
DW	13490,	12898,	12335,	11799,	11288,	10803
;;	24		25		26		27		28		29
DW	10340,	9900,	9472,	9064,	8676,	8307
;;	30		31		32		33		34		35
DW	7955,	7619,	7300,	6995,	6705,	6428
;;	36		37		38		39		40		41
DW	6163,	5911,	5671,	5441,	5222,	5013	
;;	42		43		44		45		46		47
DW	4813,	4622,	4440,	4266,	4099,	3940
;;	48		49		50		51		52		53
DW	3788,	3642,	3515,	3370,	3242,	3120
;;	54		55		56		57		58		59
DW	3003,	2891,	2784,	2681,	2583,	2489

ENDIF





PUBLIC	R_T_TAB
PUBLIC	CFG_GAIN
PUBLIC  CFG_THRESHOLD_VALUE
PUBLIC	CFG_MAX_AFTERSHOCK_TIME
PUBLIC	CFG_MIN_AFTERSHOCK_TIME
PUBLIC	CFG_DISTANCE_ADJ
PUBLIC	CFG_AFTERSHOCK_TIME_ADJ
PUBLIC	CFG_ECHO_REFERENCE_ADJ_MAX
PUBLIC	CFG_ECHO_REFERENCE_ADJ
PUBLIC	CFG_SYS